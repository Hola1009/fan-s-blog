# 认识HTTPS
同[[HTTP]]一样[[HTTPS]]也是应用层协议, 但是在[[HTTP]]的基础上引入了加密机制
[[HTTP]]协议的内容都是按照明文传输的, 这导致黑客很容易截取道传输的数据(比如: 运营商劫持)
为了解决这个问题, [[HTTPS]]就运营而生了
## 运营商劫持
![[运营商劫持]]

> [!summary] 明文传输的隐患可见一斑
居然让胡老板花了冤枉钱给别人打广告(运营商真黑)

不止运营商劫持, 黑客也会利用这个漏洞 获取用户的隐私数据
所以, 为了解决这个问题就在http的基础上引入加密机制, https就诞生啦👍


## 加密是啥🤨
加密是把`明文`(要传输的数据) 经过一系列转换变成看不懂的`密文`
解密就是加密的🔁逆过程

加密 和 解密 需要 按照一些中间数据去辅助进行吧 
这些数据就是密钥
> [!example] 举个栗子

比如 按照摩斯密码(密钥) 来进行 加密 
```
-.......---....- -...-.---.--.... ---....---..-.. -..-.---.--...-. ----.--.-..-.-- ---.---...----- -.--..-.-----.- -.-.-........--
```
不能直接考出来上面的数据是啥吧🙃
但如果看到这串数据的人如果懂摩斯密码就可以翻译出这段加密文字的意思居然是
```
胡记烤面筋真好吃
```
---
---
# HTTPS的工作过程

既然要保证数据安全, 就需要进行 "加密".
网络传输中不再直接传输明文了, 而是加密之后的 "密文".
加密的方式有很多, 但是整体可以分成两大类: `对称加密` 和 `非对称加密`

## 认识对称加密
对称❓
> ☞指的是加密和解密使用的是同一把钥匙

举个栗子:
爱喝牛奶的胡老板, 定了送奶服务. 天不亮, 送奶小哥把奶放进胡老板家门前的奶箱后就用钥匙把箱子锁上
等胡老板醒后 再用相同的钥匙开箱取奶.

那么引入对称加密机制后, 就算黑客没有钥匙拿到数据也不知数据的用途

但细心的你发现端倪没有, 和送奶小哥送奶不同, 因为用户基数太大, 服务器不可能为每个用户都维护不同的密钥
`比较理想的做法` -> 每次建立连接后再通过双方协商确定这次密钥是啥~😮
但是这样的话, 密钥就要用明文传输了 仍然有被黑客入侵的风险🐞
![[无间道黑客|500]]

所以`密钥也必须加密`

但如果相对密钥进行加密, 就得现有密钥的密钥, 那么这还得对密钥的密钥进行加密 --- 没玩咩料了还
显然行不通, 但别慌 咱们还有非`对称加密`

## 认识非对称加密
非对称加密中有两个核心概念`公钥` 和 `私钥`
- 公钥加密私钥解密
- 私钥加密公钥解密
所以只要服务端将公钥分享给客户端, 客户端用公钥读对密钥进行加密, 黑客就无法获得密钥啦 😀👍
因为只有服务器有私钥 --> 只有服务器才能解密用公钥加密的数据

但因为为公钥是所有人都可以获取的所以黑客又有了坏点子, 这回它将扮演无间道, 两头骗↔️这就是中间人攻击🐞
![[两头骗|600]]
> [!question] 如何甄别公钥是否为假

引入证书

## 引入证书

在客户端和服务器建立连接的时候, 服务器给客户端返回一个`证书`
这个`证书`包含了刚才的公钥, 也包含了网站的身份信息
>这个证书就好比人的身份证, 作为这个网站的身份标识. 搭建一个 HTTPS 网站要在CA机构先申请
>一个证书. (类似于去公安局办个身份证).
![[引入证书|600]]


`证书`即是特定结构的字符串
- 证书发布机构
- 证书有效期
- 公钥
- 证书所有者
- 签名
- ......

当客户端获取到这个证书之后, 会对证书进行校验(防止证书是伪造的).
- 判定证书的有效期是否过期
- 判定证书的发布机构是否受信任(操作系统中已内置的受信任的证书发布机构).
- 验证证书是否被篡改: 从系统中拿到该证书发布机构的公钥, 对签名解密, 得到一个 hash 值(称为数
  据摘要), 设为 hash1. 然后计算整个证书的 hash 值, 设为 hash2. 对比 hash1 和 hash2 是否相等. 
  如果相等, 则说明证书是没有被篡改过的.
所以当客户端拿到服务器发送的证书后会对证书的内容生成一个校验和1, 在用认证机构的公钥对对证书中的校验和2进行解密 对比校验和1和校验和2就知道得到的数据是否为真了🤥

> [!question] 黑客能改服务器的公钥吗

不能, 因为这个公钥在证书中, 改了, 得到的校验和就不一样了

> [!question] 黑客能改校验和吗

不能, 因为校验和是用发布机构的私钥加密的, 黑客改了, 客户端就用发布机构的公钥就无法解密, 自然就发现问题了

> [!question] 为什么加密非对称密钥的公钥不用传输

因为客户端系统内置了这个公钥

---

# 总结
HTTPS 工作过程中涉及到的密钥有三组
1. 第一组(非对称加密): 用于校验证书是否被篡改. 服务器持有私钥(私钥在注册证书时获得), 客户端持有公
钥(操作系统包含了可信任的 CA 认证机构有哪些, 同时持有对应的公钥). 服务器使用这个私钥对证书的
签名进行加密. 客户端通过这个公钥解密获取到证书的签名, 从而校验证书内容是否是篡改过.

2. 第二组(非对称加密): 用于协商生成对称加密的密钥. 服务器生成这组 私钥-公钥 对, 然后通过证书把公钥
传递给客户端. 然后客户端用这个公钥给生成的对称加密的密钥加密, 传输给服务器, 服务器通过私钥解
密获取到对称加密密钥.

3. 第三组(对称加密): 客户端和服务器后续传输的数据都通过这个对称密钥加密解密.


> 其实一切的关键都是围绕这个对称加密的密钥. 其他的机制都是辅助这个密钥工作的.

