# 介绍
是 `流量控制组件` , 主要以流量为切入点，从流量路由、`流量控制`、流量整形、`熔断降级`、系统自适应过载保护、`热点流量防护` 等多个维度来帮助开发者**保障微服务的稳定性**。 

> [!tip] 流量控制
> > 流量: 描述的是在特定时间段内，网络上发送或接收的数据量。
> 
> 而流量控制, 是为了防止有心之人恶意的向服务器频繁发送请求来获取数据, 从而导致服务器资源的浪费  

## 基本概念
### 资源
资源是 Sentinel 的关键概念。它可以是 Java 应用程序中的任何内容，例如，由应用程序提供的服务，或由应用程序调用的其它应用提供的服务，甚至可以是一段代码。在接下来的文档中，我们都会用资源来描述代码块。

只要通过 Sentinel API 定义的代码，就是资源，能够被 Sentinel 保护起来。大部分情况下，可以使用方法签名，URL，甚至服务名称作为资源名来标示资源。

> [!tip] 资源的解读
> sentinel 是做流量控制的, 就是给一段时间内返回用户的数据做控制, 防止用户频繁的获取数据; 资源是用来标识这些数据的别称, 方便 sentinel 对数据的获取频率做统计 

### 规则
规则描述了如何根据资源的实时状态，来进行流量控制、熔断降级以及系统保护。所有规则可以动态实时调整。

## sentinel 功能和设计理念
### 流量控制
系统的处理能力是有限的, 流量控制是系统的一种保护, 我们需要根据系统的处理能力对流量进行控制; 对过量的请求进行合适的处理
![](https://sentinelguard.io/docs/zh-cn/img/sentinel-flow-overview.jpg)
流量控制有以下几个角度:
- 资源的调用关系，例如资源的调用链路，资源和资源之间的关系；
- `运行指标`，例如 QPS、线程池、系统负载等；
- `控制的效果`，例如直接限流、冷启动、排队等。
### 熔断降级
除了流量控制以外，降低调用链路中的不稳定资源也是 Sentinel 的使命之一。由于调用关系的复杂性，如果调用链路中的某个资源出现了不稳定，最终会导致请求发生堆积, 降低系统性能, 所以要就要有熔断和降级来处理这些对不稳定资源的访问, 避免影响到其它的资源，最终产生雪崩的效果。
#### 熔断降级设计理念
在限制的手段上，Sentinel 和 Hystrix 采取了完全不一样的方法。
Hystrix 通过[线程池](https://github.com/Netflix/Hystrix/wiki/How-it-Works#benefits-of-thread-pools)的方式，来对依赖(在我们的概念中对应资源)进行了隔离。这样做的好处是资源和资源之间做到了最彻底的隔离。缺点是除了增加了线程切换的成本，还需要预先给各个资源做线程池大小的分配。
> [!tip] 通过线程池实现资源隔离
> 当多个服务依赖于外部资源时（如数据库、第三方API等）, 某个服务出现问题（比如响应慢或者失败）可能影响到其他服务(占用过多的线程)。使用线程池隔离的策略可以确保每种资源有其独立的执行环境，从而防止故障蔓延。
> - 隔离性:  一旦某个资源的线程池满了（例如由于高负载或长时间运行造成），它不会直接影响主应用程序或其他资源的调用。
> - 线程切换成本: 一个请求可能要调用多个资源, 因为每个资源都有自己的线程池, 所以在处理这个请求的时候就不可避免要发生上下文切换

Sentinel 对这个问题采取了两种手段:
- 通过并发线程数进行限制 -> `限流`
和资源池隔离的方法不同，Sentinel 通过限制资源并发线程的数量，来减少不稳定资源对其它资源的影响。这样不但没有线程切换的损耗，也不需要您预先分配线程池的大小。当某个资源出现不稳定的情况下，例如响应时间变长，对资源的直接影响就是会造成线程数的逐步堆积。当线程数在特定资源上堆积到一定的数量之后，`对该资源的新请求就会被拒绝`。堆积的线程完成任务后才开始继续接收请求。

> [!tip] 计数
> 每当新的请求到来，Sentinel 检查当前正在执行该资源的线程数。如果当前已处理的请求数量小于设定的最大值，那么请求就会被允许进入并处理。

- 通过响应时间对资源进行降级
除了对并发线程数进行控制以外，Sentinel 还可以通过响应时间来快速降级不稳定的资源。当依赖的资源出现响应时间过长后，所有对该资源的访问都会被直接拒绝，直到过了指定的时间窗口之后才重新恢复。

## sentinel 是如何工作的
Sentinel 的主要工作机制如下：
- 提供用来定义被保护资源的 API，并提供设施对资源进行实时统计和调用链路分析。
- 根据预设的规则，结合对资源的实时统计信息，对流量进行控制。同时，Sentinel 提供开放的接口，方便您定义及改变规则。
- Sentinel 提供实时的监控系统，方便您快速了解目前系统的状态。



